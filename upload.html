<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Initial Data</title>
</head>
<body>
    <h1>Initializing Data Upload...</h1>
    <p>Check the browser's console for details. This should only be run once.</p>
    <div id="status"></div>

    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // User's Firebase Config
        const firebaseConfig = {
          apiKey: "AIzaSyAy4aWx-DO6pVeiCq37t-PcwMvr7lhRIzw",
          authDomain: "maisto-fresh-metal.firebaseapp.com",
          projectId: "maisto-fresh-metal",
          storageBucket: "maisto-fresh-metal.firebasestorage.app",
          messagingSenderId: "237854342909",
          appId: "1:237854342909:web:0bef57068b33194ab00894",
          measurementId: "G-35FH494LSF"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Data to be uploaded
        const initialMiniaturesByBrand = {
          "Hot Wheels": [
            { id: 1, name: "Bone Shaker", image: "https://via.placeholder.com/150" },
            { id: 2, name: "Twin Mill", image: "https://via.placeholder.com/150" }
          ],
          "Matchbox": [
            { id: 1, name: "Ford Explorer", image: "https://via.placeholder.com/150" }
          ]
        };

        // The upload function
        const uploadInitialMiniaturesToFirestore = async () => {
          const statusDiv = document.getElementById('status');
          statusDiv.innerHTML = "<p>Starting upload...</p>";

          if (Object.keys(initialMiniaturesByBrand).length === 0) {
              console.warn("initialMiniaturesByBrand is empty. No data to upload.");
              statusDiv.innerHTML += "<p>Warning: No initial data found to upload.</p>";
              return;
          }

          console.log("Starting upload of initial miniatures data to Firestore...");
          for (const brandName in initialMiniaturesByBrand) {
            const brandRef = doc(db, "miniatures", brandName);
            try {
              await setDoc(brandRef, { items: initialMiniaturesByBrand[brandName] });
              const successMsg = `Data for brand '${brandName}' uploaded successfully.`;
              console.log(successMsg);
              statusDiv.innerHTML += `<p style=\"color: green;\">${successMsg}</p>`;
            } catch (error) {
              const errorMsg = `Error uploading data for brand '${brandName}': ${error.message}`;
              console.error(errorMsg, error);
              statusDiv.innerHTML += `<p style=\"color: red;\">${errorMsg}</p>`;
            }
          }
          const finalMsg = "Initial miniatures upload complete!";
          console.log(finalMsg);
          statusDiv.innerHTML += `<h2>${finalMsg}</h2>`;
        };

        // Run the upload function automatically when the page loads
        uploadInitialMiniaturesToFirestore();
    </script>
</body>
</html>